resource_types:
- name: setup-runtime-resource
  type: registry-image
  source:
    repository: registry:5000/setup-runtime-resource
    tag: latest
    insecure: true

resources:
- name: setup-runtime
  type: setup-runtime-resource
  icon: account-hard-hat
  source:
    sdkman:
      enabled: true
    nvm:
      enabled: true
    telemetry:
      disable: true
    verbose: true


jobs:
- name: test-setup-runtime
  plan:
  - get: setup-runtime

  - task: test-image
    image: setup-runtime
    privileged: true
    config:
      platform: linux

      caches:
        - path: /cache
        - path: /var/runtimes/sdkman/candidates
        - path: /var/runtimes/nvm/versions

      run:
        path: bash
        args:
          - -ec
          - |
            echo "v25.2.1" > .nvmrc
            echo "java=21.0.4-tem" > .sdkmanrc
            
            nvm install
            sdk env install
            
            sdk current
            
            node --version
            
            # The source ~/.bashrc is rerequired to set the new candidate in the path variable.
            source ~/.bashrc
            java --version

            mkdir -p subdir
            echo "v25.2.0" > subdir/.nvmrc
            echo "java=21.0.3-tem" > subdir/.sdkmanrc

            cd subdir
            nvm install
            sdk env install
            
            node --version
            java --version
            cd ..
            
            nvm use
            sdk env install
            
            node --version
            java --version
